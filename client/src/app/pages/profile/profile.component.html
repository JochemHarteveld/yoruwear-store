<!-- Profile Page -->
<div class="profile-page">
  <!-- Tab Navigation -->
  <div class="tabs">
    <button 
      type="button"
      class="tab-button"
      [class.active]="activeTab() === 'personal'"
      (click)="setActiveTab('personal')">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
      Personal Info
    </button>
    <button 
      type="button"
      class="tab-button"
      [class.active]="activeTab() === 'address'"
      (click)="setActiveTab('address')">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
        <circle cx="12" cy="10" r="3"></circle>
      </svg>
      Address
    </button>
    <button 
      type="button"
      class="tab-button"
      [class.active]="activeTab() === 'orders'"
      (click)="setActiveTab('orders')">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 11l3 3l8-8"></path>
        <path d="M21 12c-1 0-3-1-3-3s2-3 3-3s3 1 3 3s-2 3-3 3"></path>
        <path d="M3 11l3 3l8-8"></path>
      </svg>
      Order History
    </button>
  </div>

  <!-- Tab Content -->
  <div class="tab-content">
    <!-- Personal Info Tab -->
    @if (activeTab() === 'personal') {
      <div class="section-content">
        <div class="section-header">
          <h3>Personal Information</h3>
          <span class="section-description">Manage your personal details and preferences</span>
        </div>

        <div class="personal-info-section">
          @if (!editingPersonal()) {
            <div class="info-display">
              <div class="info-item">
                <label>Full Name</label>
                <span>{{ user()?.fullName || 'Not provided' }}</span>
              </div>
              <div class="info-item">
                <label>Email</label>
                <span>{{ user()?.email || 'Not provided' }}</span>
              </div>
              <div class="info-item">
                <label>Phone</label>
                <span>{{ user()?.phone || 'Not provided' }}</span>
              </div>
              
              <div class="action-buttons">
                <button type="button" class="edit-button" (click)="startEditingPersonal()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="m18.5 2.5 a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                  Edit Information
                </button>
                
                <button type="button" class="logout-button" (click)="logout()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16,17 21,12 16,7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                  </svg>
                  Logout
                </button>
              </div>
            </div>
          } @else {
            <form [formGroup]="personalForm" (ngSubmit)="savePersonalInfo()" class="edit-form">
              <div class="form-row">
                <div class="form-group">
                  <label for="fullName">Full Name</label>
                  <input 
                    type="text" 
                    id="fullName" 
                    formControlName="fullName"
                    placeholder="Enter your full name">
                </div>
                <div class="form-group">
                  <label for="email">Email</label>
                  <input 
                    type="email" 
                    id="email" 
                    formControlName="email"
                    placeholder="Enter your email">
                </div>
              </div>
              <div class="form-group">
                <label for="phone">Phone</label>
                <input 
                  type="tel" 
                  id="phone" 
                  formControlName="phone"
                  placeholder="Enter your phone number">
              </div>
              <div class="form-actions">
                <button type="button" class="cancel-button" (click)="cancelEditingPersonal()">
                  Cancel
                </button>
                <button type="submit" class="save-button" [disabled]="personalForm.invalid">
                  Save Changes
                </button>
              </div>
            </form>
          }
        </div>
      </div>
    }

    <!-- Address Tab -->
    @if (activeTab() === 'address') {
      <div class="section-content">
        <div class="section-header">
          <h3>Delivery Address</h3>
          <span class="section-description">Your delivery address information</span>
        </div>

        @if (addresses() && addresses().length > 0) {
          <div class="address-display">
            @for (address of addresses(); track address.id) {
              <div class="address-info">
                <div class="address-content">
                  <h4>{{ address.fullName }}</h4>
                  <p>{{ address.streetAddress }}</p>
                  <p>{{ address.city }}, {{ address.postalCode }}</p>
                  <p>{{ address.country }}</p>
                  @if (address.phone) {
                    <p>Phone: {{ address.phone }}</p>
                  }
                </div>
              </div>
            }
          </div>
        } @else {
          <div class="no-addresses">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <h4>No delivery address</h4>
            <p>You can set up your delivery address during checkout</p>
          </div>
        }
      </div>
    }

    <!-- Orders Tab -->
    @if (activeTab() === 'orders') {
      <div class="section-content">
        <div class="section-header">
          <h3>Order History</h3>
          <span class="section-description">View your past orders</span>
        </div>

        <div class="orders-section">
          @if (loadingOrders()) {
            <div class="loading-state">
              <div class="spinner"></div>
              <p>Loading your orders...</p>
            </div>
          } @else if (orders() && orders().length > 0) {
            <div class="orders-list">
              @for (order of orders(); track order.id) {
                <div class="order-card">
                  <div class="order-header">
                    <div class="order-info">
                      <h4>Order {{ order.orderNumber }}</h4>
                      <span class="order-date">{{ formatDate(order.createdAt) }}</span>
                    </div>
                    <div class="order-status">
                      <span class="status-badge" [class]="order.status">
                        {{ order.status | titlecase }}
                      </span>
                    </div>
                  </div>
                  <div class="order-details">
                    <div class="order-items">
                      @for (item of order.items; track item.id) {
                        <div class="order-item">
                          <span class="item-name">{{ item.name }}</span>
                          <span class="item-quantity">Qty: {{ item.quantity }}</span>
                          <span class="item-price">€{{ item.price.toFixed(2) }}</span>
                        </div>
                      }
                    </div>
                    <div class="order-summary">
                      <div class="summary-row">
                        <span>Subtotal:</span>
                        <span>€{{ order.subtotal.toFixed(2) }}</span>
                      </div>
                      <div class="summary-row">
                        <span>Delivery:</span>
                        <span>€{{ order.deliveryCost.toFixed(2) }}</span>
                      </div>
                      <div class="summary-row total">
                        <span>Total:</span>
                        <span>€{{ order.total.toFixed(2) }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="no-orders">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M9 11l3 3l8-8"></path>
                <path d="M21 12c-1 0-3-1-3-3s2-3 3-3s3 1 3 3s-2 3-3 3"></path>
                <path d="M3 11l3 3l8-8"></path>
              </svg>
              <h4>No orders yet</h4>
              <p>When you place your first order, it will appear here</p>
              <button type="button" class="shop-now-button" (click)="goToShop()">
                Start Shopping
              </button>
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>